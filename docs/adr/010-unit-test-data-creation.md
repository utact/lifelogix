# [ADR-010] 단위 테스트 데이터 생성 전략 표준화

- **Status:** Adopted
- **Last Updated:** 2025-10-19

---

## 요약 (Summary)

단위 테스트의 가독성과 생산성을 높이기 위해, 엔티티 객체 직접 생성을 원칙으로 하고, 프로덕션 코드에서의 오용을 막기 위해 테스트 전용 생성자에 `@Deprecated` 주석을 사용한다.

---

## Context (컨텍스트)

단위 테스트 작성 시, 테스트 대상 객체가 의존하는 엔티티(Entity) 데이터를 생성하는 방식이 일관되지 않았다. `Mockito.mock()`은 설정이 복잡하고, `new` 키워드로 직접 생성하는 방식은 프로덕션 코드에서 오용될 위험이 있다.

---

## Decision (결정)

**단위 테스트의 데이터 생성 시, 실제 객체 생성을 원칙으로 하며, 이를 위한 '테스트 전용 생성자'에 `@Deprecated` 주석을 사용하는 전략을 채택한다.**

-   엔티티 클래스에는 ID를 포함하여 객체의 모든 상태를 초기화할 수 있는 `public` 생성자를 추가한다.
-   이 생성자는 오직 테스트 코드에서의 사용을 목적으로 하며, 프로덕션 코드에서의 오용을 방지하기 위해 반드시 `@Deprecated` 주석을 명시한다.
-   IDE는 `@Deprecated`로 표시된 메서드나 생성자 사용 시 경고를 표시하므로, 개발자가 실수로 사용하는 것을 효과적으로 방지할 수 있다.

```java
@Entity
public class User {
    // ... 필드 ...

    // 프로덕션 코드용 생성자
    @Builder
    public User(...) { ... }

    @Deprecated // 테스트용 생성자
    public User(Long id, String email, String nickname, ...) {
        // ... 필드 초기화 ...
    }
}
```

---

## Consequences (결과)

### 긍정적
- **테스트 코드의 가독성 및 생산성 향상:** `Mockito`의 복잡한 `when-then` 체인 없이, 생성자를 통해 한 줄로 명확하게 테스트 데이터를 생성할 수 있어 테스트 코드 작성이 간결해지고 빨라진다.
- **안정적인 테스트:** 실제 객체를 사용함으로써, Mock 객체가 실제 객체의 동작과 달라 발생할 수 있는 테스트의 불확실성을 줄일 수 있다.
- **오용 방지:** `@Deprecated` 주석이 프로덕션 코드에서 테스트용 생성자를 사용하는 것을 방지하는 효과적인 안전장치 역할을 한다.

### 부정적
- **캡슐화 원칙의 완화:** 엔티티에 테스트만을 위한 `public` 생성자가 노출되어, 객체지향의 캡슐화 원칙이 일부 완화된다. 하지만 이는 테스트 생산성 향상이라는 더 큰 이점을 위해 감수할 수 있는 수준의 트레이드오프이다.

# [ADR-011] 단위 테스트 데이터 생성 전략 수립

- **Status:** Adopted
- **Last Updated:** 2025-10-07

---

## Context (컨텍스트)

서비스 계층의 단위 테스트(`@ExtendWith(MockitoExtension.class)`)를 작성하는 과정에서, 의존성 객체인 엔티티(Entity)의 테스트 데이터를 생성하는 두 가지 방식이 혼용되었습니다.

1.  **`Mockito.mock()` 사용**: 의존 객체를 완전히 가짜(Mock)로 만들고, 각 메서드의 반환 값을 `when().thenReturn()`으로 일일이 정의하는 방식.
2.  **테스트용 생성자 사용**: 엔티티에 ID 등 테스트에 필요한 값을 포함하는 생성자를 추가하고, `new` 키워드로 실제 객체를 생성하여 사용하는 방식.

프로젝트 전체의 테스트 코드 스타일 일관성을 위해 표준화된 데이터 생성 전략 수립이 필요해졌습니다. 처음에는 테스트용 생성자를 `package-private`으로 제한하여 도메인 캡슐화를 유지하려 했으나, 테스트 코드의 패키지(`...application`)와 도메인 엔티티의 패키지(`...domain`)가 달라 접근이 불가능한 문제가 발견되었습니다.

---

## Decision (결정)

서비스 계층 단위 테스트에서 엔티티 테스트 데이터를 생성할 때, **`@deprecated` 주석을 포함한 '테스트용 `public` 생성자'를** 사용하는 것을 표준 방식으로 채택합니다.

-   모든 엔티티 클래스는 프로덕션 코드에서 사용하는 생성자 외에, 테스트 데이터 생성을 위한 `public` 생성자를 추가할 수 있습니다.
-   이 생성자는 ID를 포함하여 객체의 모든 상태를 초기화할 수 있어야 합니다.
-   개발자가 프로덕션 코드에서 이 생성자를 실수로 사용하는 것을 방지하기 위해, **반드시 `@deprecated` 주석을 추가**하여 IDE 경고를 유도합니다.

**예시:**
```java
@Entity
public class Category {
    // ... 필드

    // 프로덕션용
    public Category(String name, ...) { ... }

    /**
     * @deprecated 오직 테스트 코드에서만 사용하기 위한 생성자
     **/
    public Category(Long id, String name, ...) { ... }
}
```

---

## Consequences (결과)

### 긍정적
-   **일관성 확보**: 모든 단위 테스트가 동일한 방식으로 테스트 데이터를 생성하게 되어 코드의 통일성이 향상됩니다.
-   **가독성 및 생산성 증대**: `Mockito.mock()`의 복잡한 설정 없이, 생성자를 통해 한 줄로 명확하게 테스트 데이터를 생성할 수 있어 테스트 코드 작성이 간결해지고 빨라집니다.
-   **오용 방지**: `@deprecated` 주석을 통해 테스트용 생성자가 프로덕션 코드에서 사용될 위험을 최소화합니다.

### 부정적
-   엔티티 클래스에 테스트만을 위한 `public` 생성자가 노출되어 도메인의 캡슐화가 완벽하게 지켜지지는 않습니다. 하지만 이는 `@deprecated` 주석으로 위험을 완화하고, 테스트 편의성으로 얻는 이점이 더 크다고 판단합니다.
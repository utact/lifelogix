# [ADR-007] 계층적 하이브리드 카테고리 모델 도입

- **Status:** Adopted
- **Refines:** `ADR-006-jwt-handling-strategy-unification.md`
- **Last Updated:** 2025-10-06

---

## Context (컨텍스트)

`ADR-006` 결정 이후, `Category` 엔티티를 사용자별로 관리할지(개인화) 시스템 전체에서 공유할지(표준화)에 대한 추가 논의가 진행되었다.

- **개인화의 장점:** 사용자에게 높은 자유도를 제공한다.
- **표준화의 장점:** 데이터 분석 및 집계에 용이하다.

단순히 `user_id`를 nullable로 두는 하이브리드 모델은 두 가지 장점을 모두 만족시키지 못했다. 사용자가 생성한 커스텀 카테고리(예: '사이드 프로젝트', '회사 업무')를 표준화된 기준(예: '업무')으로 묶어서 분석할 수 있는 방법이 필요했다.

---

## Decision (결정)

사용자 경험의 개인화와 데이터 분석의 용이성을 모두 충족시키기 위해 **"계층적 하이브리드 모델(Hierarchical Hybrid Model)"을** 도입하기로 결정한다.

1.  **`Category` 엔티티에 자기참조(Self-Referencing) 관계를 추가한다.**
    - `parent` 필드를 추가하여 부모-자식 관계를 형성한다.

2.  **카테고리를 두 종류로 정의한다.**
    - **시스템 기본 카테고리 (Root):**
        - `user_id` 와 `parent_id` 가 모두 `NULL`이다.
        - 데이터 분석의 표준 집계 기준으로 사용된다. (예: 업무, 학습, 운동)
    - **사용자 정의 카테고리 (Leaf):**
        - `user_id` 에는 사용자의 ID가 저장된다.
        - `parent_id` 에는 **반드시 시스템 기본 카테고리의 ID가 연결**되어야 한다.

이 구조를 통해 모든 사용자 정의 카테고리는 표준화된 상위 카테고리에 매핑된다.

---

## Consequences (결과)

### 긍정적
- **데이터 분석과 개인화 동시 달성:** 모든 활동 기록은 상위 카테고리를 통해 표준화된 분석이 가능하면서, 사용자는 자신만의 용어로 활동을 분류할 수 있다.
- **풍부한 데이터 컨텍스트:** '학습(부모)'이라는 큰 틀 안에서 'AWS 자격증 공부(자식)'라는 구체적인 활동 내용을 모두 파악할 수 있어 데이터의 가치가 높아진다.
- **높은 확장성:** 향후 카테고리의 중첩 구조(depth)를 늘리는 등 기능 확장이 용이하다.

### 부정적 (고려사항)
- **UI/UX 복잡도 증가:** 사용자가 커스텀 카테고리를 생성할 때 부모 카테고리를 선택하는 추가적인 단계가 필요하다.
- **데이터 조회 복잡도 증가:** 특정 활동의 최상위 카테고리를 알기 위해서는 최소 한 단계 이상의 추가적인 데이터 조회가 필요할 수 있다.